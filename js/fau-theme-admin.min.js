var wpLink;!function(l){var n,t,e,i,a,o={},s={},r="ontouchend"in document;wpLink={timeToTriggerRiver:150,minRiverAJAXDuration:200,riverBottomThreshold:5,keySensitivity:100,lastSearch:"",textarea:"",init:function(){o.wrap=l("#wp-link-wrap"),o.dialog=l("#wp-link"),o.backdrop=l("#wp-link-backdrop"),o.submit=l("#wp-link-submit"),o.close=l("#wp-link-close"),o.text=l("#wp-link-text"),o.url=l("#wp-link-url"),o.nonce=l("#_ajax_linking_nonce"),o.openInNewTab=l("#wp-link-target"),o.search=l("#wp-link-search"),s.search=new e(l("#search-results")),s.recent=new e(l("#most-recent-results")),s.elements=o.dialog.find(".query-results"),o.queryNotice=l("#query-notice-message"),o.queryNoticeTextDefault=o.queryNotice.find(".query-notice-default"),o.queryNoticeTextHint=o.queryNotice.find(".query-notice-hint"),o.dialog.keydown(wpLink.keydown),o.dialog.keyup(wpLink.keyup),o.submit.click(function(e){e.preventDefault(),wpLink.update()}),o.close.add(o.backdrop).add("#wp-link-cancel a").click(function(e){e.preventDefault(),wpLink.close()}),l("#wp-link-search-toggle").on("click",wpLink.toggleInternalLinking),s.elements.on("river-select",wpLink.updateFields),o.search.on("focus.wplink",function(){o.queryNoticeTextDefault.hide(),o.queryNoticeTextHint.removeClass("screen-reader-text").show()}).on("blur.wplink",function(){o.queryNoticeTextDefault.show(),o.queryNoticeTextHint.addClass("screen-reader-text").hide()}),o.search.on("keyup input",function(){var e=this;window.clearTimeout(t),t=window.setTimeout(function(){wpLink.searchInternalLinks.call(e)},500)}),o.url.on("paste",function(){setTimeout(wpLink.correctURL,0)}),o.url.on("blur",wpLink.correctURL)},correctURL:function(){var e=l.trim(o.url.val());e&&a!==e&&!/^(?:[a-z]+:|#|\?|\.|\/)/.test(e)&&(o.url.val("http://"+e),a=e)},open:function(e){var t,i=l(document.body);i.addClass("modal-open"),wpLink.range=null,e&&(window.wpActiveEditor=e),window.wpActiveEditor&&(this.textarea=l("#"+window.wpActiveEditor).get(0),"undefined"!=typeof tinymce&&(i.append(o.backdrop,o.wrap),t=tinymce.get(wpActiveEditor),(n=t&&!t.isHidden()?t:null)&&tinymce.isIE&&(n.windowManager.bookmark=n.selection.getBookmark())),!wpLink.isMCE()&&document.selection&&(this.textarea.focus(),this.range=document.selection.createRange()),o.wrap.show(),o.backdrop.show(),wpLink.refresh(),l(document).trigger("wplink-open",o.wrap))},isMCE:function(){return n&&!n.isHidden()},refresh:function(){var e="";s.search.refresh(),s.recent.refresh(),wpLink.isMCE()?wpLink.mceRefresh():(o.wrap.hasClass("has-text-field")||o.wrap.addClass("has-text-field"),document.selection?e=document.selection.createRange().text||"":void 0!==this.textarea&&void 0!==this.textarea.selectionStart&&this.textarea.selectionStart!==this.textarea.selectionEnd&&(e=this.textarea.value.substring(this.textarea.selectionStart,this.textarea.selectionEnd)||""),o.text.val(e),wpLink.setDefaultValues()),r?o.url.focus().blur():o.url.focus()[0].select(),s.recent.ul.children().length||s.recent.ajax(),a=o.url.val().replace(/^http:\/\//,"")},hasSelectedText:function(e){var t=n.selection.getContent();if(/</.test(t)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(t)||-1===t.indexOf("href=")))return!1;if(e){var i,a=e.childNodes;if(0===a.length)return!1;for(i=a.length-1;0<=i;i--)if(3!=a[i].nodeType)return!1}return!0},mceRefresh:function(){var e,t=n.selection.getNode(),i=n.dom.getParent(t,"a[href]"),a=this.hasSelectedText(i);i?(e=i.innerText||i.textContent,o.url.val(n.dom.getAttrib(i,"href")),o.openInNewTab.prop("checked","_blank"===n.dom.getAttrib(i,"target")),o.submit.val(wpLinkL10n.update)):(e=n.selection.getContent({format:"text"}),this.setDefaultValues()),a?(o.text.val(e||""),o.wrap.addClass("has-text-field")):(o.text.val(""),o.wrap.removeClass("has-text-field"))},close:function(){l(document.body).removeClass("modal-open"),wpLink.isMCE()?n.focus():(wpLink.textarea.focus(),wpLink.range&&(wpLink.range.moveToBookmark(wpLink.range.getBookmark()),wpLink.range.select())),o.backdrop.hide(),o.wrap.hide(),a=!1,l(document).trigger("wplink-close",o.wrap)},getAttrs:function(){return wpLink.correctURL(),{href:l.trim(o.url.val()),target:o.openInNewTab.prop("checked")?"_blank":"",title:l.trim(o.text.val())}},buildHtml:function(e){var t='<a href="'+e.href+'"';return e.target&&(t+=' target="'+e.target+'"'),t+">"},update:function(){wpLink.isMCE()?wpLink.mceUpdate():wpLink.htmlUpdate()},htmlUpdate:function(){var e,t,i,a,n,s,l,r=wpLink.textarea;r&&(e=wpLink.getAttrs(),t=o.text.val(),e.href&&(i=wpLink.buildHtml(e),document.selection&&wpLink.range?(r.focus(),wpLink.range.text=i+(t||wpLink.range.text)+"</a>",wpLink.range.moveToBookmark(wpLink.range.getBookmark()),wpLink.range.select(),wpLink.range=null):void 0!==r.selectionStart&&(a=r.selectionStart,n=r.selectionEnd,s=a+(i=i+(l=t||r.value.substring(a,n))+"</a>").length,a!==n||l||(s-=4),r.value=r.value.substring(0,a)+i+r.value.substring(n,r.value.length),r.selectionStart=r.selectionEnd=s),wpLink.close(),r.focus()))},mceUpdate:function(){var e,t,i=wpLink.getAttrs();wpLink.close(),n.focus(),tinymce.isIE&&n.selection.moveToBookmark(n.windowManager.bookmark),i.href?(e=n.dom.getParent(n.selection.getNode(),"a"),o.wrap.hasClass("has-text-field")&&(t=o.text.val()||i.href),e?(t&&("innerText"in e?e.innerText=t:e.textContent=t),n.dom.setAttribs(e,i)):t?n.selection.setNode(n.dom.create("a",i,t)):n.execCommand("mceInsertLink",!1,i),n.nodeChanged()):n.execCommand("unlink")},updateFields:function(e,t){o.url.val(t.children(".item-permalink").val())},setDefaultValues:function(){var e;this.isMCE()?e=n.selection.getContent():document.selection&&wpLink.range?e=wpLink.range.text:void 0!==this.textarea&&void 0!==this.textarea.selectionStart&&(e=this.textarea.value.substring(this.textarea.selectionStart,this.textarea.selectionEnd)),e&&/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i.test(e)?o.url.val("mailto:"+e):e&&/^(https?|ftp):\/\/[A-Z0-9.-]+\.[A-Z]{2,4}[^ "]*$/i.test(e)?o.url.val(e.replace(/&amp;|&#0?38;/gi,"&")):o.url.val(""),o.submit.val(wpLinkL10n.save)},searchInternalLinks:function(){var e,t=l(this),i=t.val();if(2<i.length){if(s.recent.hide(),s.search.show(),wpLink.lastSearch==i)return;wpLink.lastSearch=i,e=t.parent().find(".spinner").addClass("is-active"),s.search.change(i),s.search.ajax(function(){e.removeClass("is-active")})}else s.search.hide(),s.recent.show()},next:function(){s.search.next(),s.recent.next()},prev:function(){s.search.prev(),s.recent.prev()},keydown:function(e){var t,i,a=l.ui.keyCode;a.ESCAPE===e.keyCode?(wpLink.close(),e.stopImmediatePropagation()):a.TAB===e.keyCode&&("wp-link-submit"!==(i=e.target.id)||e.shiftKey?"wp-link-close"===i&&e.shiftKey&&(o.submit.focus(),e.preventDefault()):(o.close.focus(),e.preventDefault())),e.keyCode!==a.UP&&e.keyCode!==a.DOWN||document.activeElement&&("link-title-field"===document.activeElement.id||"url-field"===document.activeElement.id)||(t=e.keyCode===a.UP?"prev":"next",clearInterval(wpLink.keyInterval),wpLink[t](),wpLink.keyInterval=setInterval(wpLink[t],wpLink.keySensitivity),e.preventDefault())},keyup:function(e){var t=l.ui.keyCode;e.which!==t.UP&&e.which!==t.DOWN||(clearInterval(wpLink.keyInterval),e.preventDefault())},delayedCallback:function(e,t){var i,a,n,s;return t?(setTimeout(function(){return a?e.apply(s,n):void(i=!0)},t),function(){if(i)return e.apply(this,arguments);n=arguments,s=this,a=!0}):e},toggleInternalLinking:function(e){var t=o.wrap.hasClass("search-panel-visible");o.wrap.toggleClass("search-panel-visible",!t),setUserSetting("wplink",t?"0":"1"),o[t?"url":"search"].focus(),e.preventDefault()}},e=function(e,t){var i=this;this.element=e,this.ul=e.children("ul"),this.contentHeight=e.children("#link-selector-height"),this.waiting=e.find(".river-waiting"),this.change(t),this.refresh(),l("#wp-link .query-results, #wp-link #link-selector").scroll(function(){i.maybeLoad()}),e.on("click","li",function(e){i.select(l(this),e)})},l.extend(e.prototype,{refresh:function(){this.deselect(),this.visible=this.element.is(":visible")},show:function(){this.visible||(this.deselect(),this.element.show(),this.visible=!0)},hide:function(){this.element.hide(),this.visible=!1},select:function(e,t){var i,a,n,s;e.hasClass("unselectable")||e==this.selected||(this.deselect(),this.selected=e.addClass("selected"),i=e.outerHeight(),a=this.element.height(),n=e.position().top,s=this.element.scrollTop(),n<0?this.element.scrollTop(s+n):a<n+i&&this.element.scrollTop(s+n-a+i),this.element.trigger("river-select",[e,t,this]))},deselect:function(){this.selected&&this.selected.removeClass("selected"),this.selected=!1},prev:function(){var e;this.visible&&this.selected&&(e=this.selected.prev("li")).length&&this.select(e)},next:function(){var e;!this.visible||(e=this.selected?this.selected.next("li"):l("li:not(.unselectable):first",this.element)).length&&this.select(e)},ajax:function(i){var a=this,e=1==this.query.page?0:wpLink.minRiverAJAXDuration,t=wpLink.delayedCallback(function(e,t){a.process(e,t),i&&i(e,t)},e);this.query.ajax(t)},change:function(e){this.query&&this._search==e||(this._search=e,this.query=new i(e),this.element.scrollTop(0))},process:function(e,t){var i,a="",n=!0,s=1==t.page;e?l.each(e,function(){i=n?"alternate":"",i+=this.title?"":" no-title",a+=i?'<li class="'+i+'">':"<li>",a+='<input type="hidden" class="item-permalink" value="'+this.permalink+'" />',a+='<span class="item-title">',a+=this.title?this.title:wpLinkL10n.noTitle,a+='</span><span class="item-info">'+this.info+"</span></li>",n=!n}):s&&(a+='<li class="unselectable no-matches-found"><span class="item-title"><em>'+wpLinkL10n.noMatchesFound+"</em></span></li>"),this.ul[s?"html":"append"](a)},maybeLoad:function(){var i=this,a=this.element,e=a.scrollTop()+a.height();!this.query.ready()||e<this.contentHeight.height()-wpLink.riverBottomThreshold||setTimeout(function(){var e=a.scrollTop(),t=e+a.height();!i.query.ready()||t<i.contentHeight.height()-wpLink.riverBottomThreshold||(i.waiting.addClass("is-active"),a.scrollTop(e+i.waiting.outerHeight()),i.ajax(function(){i.waiting.removeClass("is-active")}))},wpLink.timeToTriggerRiver)}}),i=function(e){this.page=1,this.allLoaded=!1,this.querying=!1,this.search=e},l.extend(i.prototype,{ready:function(){return!(this.querying||this.allLoaded)},ajax:function(t){var i=this,a={action:"wp-link-ajax",page:this.page,_ajax_linking_nonce:o.nonce.val()};this.search&&(a.search=this.search),this.querying=!0,l.post(ajaxurl,a,function(e){i.page++,i.querying=!1,i.allLoaded=!e,t(e,a)},"json")}}),l(document).ready(wpLink.init)}(jQuery),jQuery(document).ready(function(s){var l;s("body").on("click",".upload_image_button",function(e){e.preventDefault();var t=s(this),i=t.attr("id").replace("_button",""),a=t.attr("id").replace("url_button","id"),n=t.attr("id").replace("image_url_button","title");l||(l=wp.media.frames.file_frame=wp.media({title:"Choose Image",button:{text:"Choose Image"},library:{type:"image"},multiple:!1})).on("select",function(){var e=l.state().get("selection").first().toJSON();s("#"+i).val(e.url),s("#"+a).val(e.id),s("#"+n).val()||s("#"+n).val(e.title)}),l.open()}),"page-templates/page-start.php"==s("#page_template").val()||"page-templates/page-start-sub.php"==s("#page_template").val()||"page-templates/page-portalindex.php"==s("#page_template").val()||"page-templates/page-portal.php"==s("#page_template").val()?(s("#fau_metabox_page_imagelinks").show(),s("#fau_metabox_page_portalmenu").show(),s("#fau_metabox_page_subnavmenu").hide(),"page-templates/page-portal.php"==s("#page_template").val()||"page-templates/page-portalindex.php"==s("#page_template").val()?(s("#portalseitenquote").show(),s("#fau_metabox_page_untertitel").show()):(s("#portalseitenquote").hide(),s("#fau_metabox_page_untertitel").hide())):(s("#fau_metabox_page_imagelinks").hide(),s("#fau_metabox_page_portalmenu").hide(),s("#fau_metabox_page_untertitel").show(),"page-templates/page-subnav.php"==s("#page_template").val()?s("#fau_metabox_page_subnavmenu").show():s("#fau_metabox_page_subnavmenu").hide()),s(document).on("change","#page_template",function(){"page-templates/page-start.php"==s(this).val()||"page-templates/page-start-sub.php"==s(this).val()||"page-templates/page-portal.php"==s(this).val()||"page-templates/page-portalindex.php"==s(this).val()?(s("#fau_metabox_page_imagelinks").show(),s("#fau_metabox_page_subnavmenu").hide(),s("#fau_metabox_page_portalmenu").show(),"page-templates/page-portal.php"==s(this).val()||"page-templates/page-portalindex.php"==s(this).val()?(s("#portalseitenquote").show(),s("#fau_metabox_page_untertitel").show()):(s("#portalseitenquote").hide(),s("#fau_metabox_page_untertitel").hide())):(s("#fau_metabox_page_imagelinks").hide(),s("#fau_metabox_page_portalmenu").hide(),s("#fau_metabox_page_untertitel").show(),"page-templates/page-subnav.php"==s(this).val()?s("#fau_metabox_page_subnavmenu").show():s("#fau_metabox_page_subnavmenu").hide())})});